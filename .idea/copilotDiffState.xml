<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/public/index.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/public/index.php" />
              <option name="originalContent" value="&lt;?php&#10;declare(strict_types=1);&#10;&#10;$xkcdBase = 'https://xkcd.com';&#10;$timeout  = 6;&#10;&#10;/**&#10; * Llama al endpoint de XKCD. Si $num es null → cómic actual.&#10; * Devuelve array con datos o null si hay error.&#10; */&#10;function fetchXkcd(?int $num, string $base, int $timeout): ?array {&#10;    $url = $num ? &quot;{$base}/{$num}/info.0.json&quot; : &quot;{$base}/info.0.json&quot;;&#10;&#10;    $ch = curl_init($url);&#10;    curl_setopt_array($ch, [&#10;            CURLOPT_RETURNTRANSFER =&gt; true,&#10;            CURLOPT_CONNECTTIMEOUT =&gt; $timeout,&#10;            CURLOPT_TIMEOUT        =&gt; $timeout,&#10;            CURLOPT_FOLLOWLOCATION =&gt; true,&#10;            CURLOPT_USERAGENT      =&gt; 'xkcd-miniapp/step2',&#10;    ]);&#10;    $res = curl_exec($ch);&#10;&#10;    if ($res === false) {&#10;        curl_close($ch);&#10;        return null; // error de red&#10;    }&#10;&#10;    $status = curl_getinfo($ch, CURLINFO_HTTP_CODE);&#10;    curl_close($ch);&#10;&#10;    if ($status !== 200) {&#10;        return null; // p.ej. 404 si el número no existe&#10;    }&#10;&#10;    $data = json_decode($res, true);&#10;    return is_array($data) ? $data : null;&#10;}&#10;&#10;function htmlError(string $msg): void {&#10;    $safe = htmlspecialchars($msg, ENT_QUOTES, 'UTF-8');&#10;    http_response_code(502);&#10;    echo &lt;&lt;&lt;HTML&#10;&lt;!doctype html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;&#10;&lt;title&gt;Error – XKCD&lt;/title&gt;&#10;&lt;style&gt;body{font-family:system-ui;margin:24px;color:#b00020}a{color:#0b5}&lt;/style&gt;&#10;&lt;/head&gt;&lt;body&gt;&#10;&lt;h1&gt;Something went wrong&lt;/h1&gt;&#10;&lt;p&gt;{$safe}&lt;/p&gt;&#10;&lt;p&gt;&lt;a href=&quot;/&quot;&gt;Go home&lt;/a&gt;&lt;/p&gt;&#10;&lt;/body&gt;&lt;/html&gt;&#10;HTML;&#10;    exit;&#10;}&#10;&#10;/** 1) Traer el “latest” para saber el límite superior */&#10;$latest = fetchXkcd(null, $xkcdBase, $timeout);&#10;if (!$latest) {&#10;    htmlError('Network/API error reaching XKCD for the latest comic.');&#10;}&#10;$latestNum = (int)($latest['num'] ?? 1);&#10;&#10;/** 2) Leer ?id y acotarlo a [1, $latestNum] */&#10;$requested = filter_input(INPUT_GET, 'id', FILTER_VALIDATE_INT);&#10;if ($requested !== null &amp;&amp; $requested !== false) {&#10;    $requested = max(1, min($latestNum, $requested));&#10;} else {&#10;    $requested = null; // null → actual&#10;}&#10;&#10;/** 3) Traer el cómic solicitado (o actual si null) */&#10;$comic = fetchXkcd($requested, $xkcdBase, $timeout);&#10;if (!$comic) {&#10;    // Ej: número inexistente o caída de red&#10;    htmlError('The comic you requested does not exist or the network failed.');&#10;}&#10;&#10;/** 4) Datos y fecha robusta */&#10;$num   = (int)($comic['num'] ?? 0);&#10;$title = htmlspecialchars($comic['title'] ?? 'Unknown', ENT_QUOTES, 'UTF-8');&#10;$img   = htmlspecialchars($comic['img'] ?? '', ENT_QUOTES, 'UTF-8');&#10;$alt   = htmlspecialchars($comic['alt'] ?? '', ENT_QUOTES, 'UTF-8');&#10;&#10;$y = (int)($comic['year'] ?? 0);&#10;$m = (int)($comic['month'] ?? 0);&#10;$d = (int)($comic['day'] ?? 0);&#10;&#10;if ($y &gt;= 1 &amp;&amp; checkdate($m ?: 1, $d ?: 1, $y)) {&#10;    $dt = DateTimeImmutable::createFromFormat('!Y-n-j', &quot;{$y}-{$m}-{$d}&quot;);&#10;    $date = $dt ? $dt-&gt;format('Y-m-d') : sprintf('%04d-%02d-%02d', $y, max(1,$m), max(1,$d));&#10;} else {&#10;    $date = '0000-01-01';&#10;}&#10;&#10;/** 5) Navegación (prev/next/random) con límites */&#10;$prev   = max(1, $num - 1);&#10;$next   = min($latestNum, $num + 1);&#10;$rand   = random_int(1, $latestNum);&#10;$disPrev = $num &lt;= 1 ? 'disabled' : '';&#10;$disNext = $num &gt;= $latestNum ? 'disabled' : '';&#10;&#10;?&gt;&#10;&lt;!doctype html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;utf-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;&#10;    &lt;title&gt;&lt;?= $title ?&gt; – XKCD&lt;/title&gt;&#10;    &lt;style&gt;&#10;        body{font-family:system-ui, -apple-system, Segoe UI, Roboto; margin:24px}&#10;        .wrap{max-width:920px;margin:auto}&#10;        figure{margin:16px 0}&#10;        img{max-width:100%;height:auto}&#10;        nav a button{margin-right:8px;padding:8px 12px}&#10;        .meta{color:#555}&#10;        .badge{display:inline-block;background:#eee;border-radius:6px;padding:2px 8px;margin-left:8px}&#10;        form.inline{display:inline}&#10;        input[type=number]{width:110px}&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;wrap&quot;&gt;&#10;    &lt;h1&gt;&lt;?= $title ?&gt; &lt;span class=&quot;badge&quot;&gt;#&lt;?= $num ?&gt;&lt;/span&gt;&lt;/h1&gt;&#10;    &lt;p class=&quot;meta&quot;&gt;Date: &lt;?= htmlspecialchars($date, ENT_QUOTES, 'UTF-8') ?&gt; · Latest: &lt;?= $latestNum ?&gt;&lt;/p&gt;&#10;&#10;    &lt;figure&gt;&#10;        &lt;img src=&quot;&lt;?= $img ?&gt;&quot; alt=&quot;&lt;?= $alt ?&gt;&quot; title=&quot;&lt;?= $alt ?&gt;&quot;&gt;&#10;        &lt;figcaption&gt;&lt;?= $alt ?&gt;&lt;/figcaption&gt;&#10;    &lt;/figure&gt;&#10;&#10;    &lt;nav&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $prev ?&gt;&quot;&gt;&lt;button &lt;?= $disPrev ?&gt;&gt;Previous&lt;/button&gt;&lt;/a&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $next ?&gt;&quot;&gt;&lt;button &lt;?= $disNext ?&gt;&gt;Next&lt;/button&gt;&lt;/a&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $rand ?&gt;&quot;&gt;&lt;button&gt;Random&lt;/button&gt;&lt;/a&gt;&#10;&#10;        &lt;form class=&quot;inline&quot; method=&quot;get&quot; action=&quot;/&quot;&gt;&#10;            &lt;input type=&quot;number&quot; name=&quot;id&quot; min=&quot;1&quot; max=&quot;&lt;?= $latestNum ?&gt;&quot; placeholder=&quot;Go to #&quot;&gt;&#10;            &lt;button type=&quot;submit&quot;&gt;Go&lt;/button&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;a href=&quot;/&quot;&gt;&lt;button&gt;Today&lt;/button&gt;&lt;/a&gt;&#10;    &lt;/nav&gt;&#10;&lt;/div&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;declare(strict_types=1);&#10;&#10;$xkcdBase = 'https://xkcd.com';&#10;$timeout  = 6;&#10;&#10;/**&#10; * Llama al endpoint de XKCD. Si $num es null → cómic actual.&#10; * Devuelve array con datos o null si hay error.&#10; */&#10;function fetchXkcd(?int $num, string $base, int $timeout): ?array {&#10;    $url = $num ? &quot;{$base}/{$num}/info.0.json&quot; : &quot;{$base}/info.0.json&quot;;&#10;&#10;    $ch = curl_init($url);&#10;    curl_setopt_array($ch, [&#10;            CURLOPT_RETURNTRANSFER =&gt; true,&#10;            CURLOPT_CONNECTTIMEOUT =&gt; $timeout,&#10;            CURLOPT_TIMEOUT        =&gt; $timeout,&#10;            CURLOPT_FOLLOWLOCATION =&gt; true,&#10;            CURLOPT_USERAGENT      =&gt; 'xkcd-miniapp/step2',&#10;    ]);&#10;    $res = curl_exec($ch);&#10;&#10;    if ($res === false) {&#10;        curl_close($ch);&#10;        return null; // error de red&#10;    }&#10;&#10;    $status = curl_getinfo($ch, CURLINFO_HTTP_CODE);&#10;    curl_close($ch);&#10;&#10;    if ($status !== 200) {&#10;        return null; // p.ej. 404 si el número no existe&#10;    }&#10;&#10;    $data = json_decode($res, true);&#10;    return is_array($data) ? $data : null;&#10;}&#10;&#10;function htmlError(string $msg): void {&#10;    $safe = htmlspecialchars($msg, ENT_QUOTES, 'UTF-8');&#10;    http_response_code(502);&#10;    echo &lt;&lt;&lt;HTML&#10;&lt;!doctype html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;&#10;&lt;title&gt;Error – XKCD&lt;/title&gt;&#10;&lt;style&gt;body{font-family:system-ui;margin:24px;color:#b00020}a{color:#0b5}&lt;/style&gt;&#10;&lt;/head&gt;&lt;body&gt;&#10;&lt;h1&gt;Something went wrong&lt;/h1&gt;&#10;&lt;p&gt;{$safe}&lt;/p&gt;&#10;&lt;p&gt;&lt;a href=&quot;/&quot;&gt;Go home&lt;/a&gt;&lt;/p&gt;&#10;&lt;/body&gt;&lt;/html&gt;&#10;HTML;&#10;    exit;&#10;}&#10;&#10;/** 1) Traer el “latest” para saber el límite superior */&#10;$latest = fetchXkcd(null, $xkcdBase, $timeout);&#10;if (!$latest) {&#10;    htmlError('Network/API error reaching XKCD for the latest comic.');&#10;}&#10;$latestNum = (int)($latest['num'] ?? 1);&#10;&#10;/** 2) Leer ?id y acotarlo a [1, $latestNum] */&#10;$requested = filter_input(INPUT_GET, 'id', FILTER_VALIDATE_INT);&#10;if ($requested !== null &amp;&amp; $requested !== false) {&#10;    $requested = max(1, min($latestNum, $requested));&#10;} else {&#10;    $requested = null; // null → actual&#10;}&#10;&#10;/** 3) Traer el cómic solicitado (o actual si null) */&#10;$comic = fetchXkcd($requested, $xkcdBase, $timeout);&#10;if (!$comic) {&#10;    echo htmlError('Comic not found or network/API error.');&#10;    exit;&#10;}&#10;&#10;/** 4) Datos y fecha robusta */&#10;$num   = (int)($comic['num'] ?? 0);&#10;$title = htmlspecialchars($comic['title'] ?? 'Unknown', ENT_QUOTES, 'UTF-8');&#10;$img   = htmlspecialchars($comic['img'] ?? '', ENT_QUOTES, 'UTF-8');&#10;$alt   = htmlspecialchars($comic['alt'] ?? '', ENT_QUOTES, 'UTF-8');&#10;&#10;$y = (int)($comic['year'] ?? 0);&#10;$m = (int)($comic['month'] ?? 0);&#10;$d = (int)($comic['day'] ?? 0);&#10;&#10;if ($y &gt;= 1 &amp;&amp; checkdate($m ?: 1, $d ?: 1, $y)) {&#10;    $dt = DateTimeImmutable::createFromFormat('!Y-n-j', &quot;{$y}-{$m}-{$d}&quot;);&#10;    $date = $dt ? $dt-&gt;format('Y-m-d') : sprintf('%04d-%02d-%02d', $y, max(1,$m), max(1,$d));&#10;} else {&#10;    $date = '0000-01-01';&#10;}&#10;&#10;/** 5) Navegación (prev/next/random) con límites */&#10;$prev   = max(1, $num - 1);&#10;$next   = min($latestNum, $num + 1);&#10;$rand   = random_int(1, $latestNum);&#10;$disPrev = $num &lt;= 1 ? 'disabled' : '';&#10;$disNext = $num &gt;= $latestNum ? 'disabled' : '';&#10;&#10;?&gt;&#10;&lt;!doctype html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;utf-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;&#10;    &lt;title&gt;&lt;?= $title ?&gt; – XKCD&lt;/title&gt;&#10;    &lt;style&gt;&#10;        body{font-family:system-ui, -apple-system, Segoe UI, Roboto; margin:24px}&#10;        .wrap{max-width:920px;margin:auto}&#10;        figure{margin:16px 0}&#10;        img{max-width:100%;height:auto}&#10;        nav a button{margin-right:8px;padding:8px 12px}&#10;        .meta{color:#555}&#10;        .badge{display:inline-block;background:#eee;border-radius:6px;padding:2px 8px;margin-left:8px}&#10;        form.inline{display:inline}&#10;        input[type=number]{width:110px}&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;wrap&quot;&gt;&#10;    &lt;h1&gt;&lt;?= $title ?&gt; &lt;span class=&quot;badge&quot;&gt;#&lt;?= $num ?&gt;&lt;/span&gt;&lt;/h1&gt;&#10;    &lt;p class=&quot;meta&quot;&gt;Date: &lt;?= htmlspecialchars($date, ENT_QUOTES, 'UTF-8') ?&gt; · Latest: &lt;?= $latestNum ?&gt;&lt;/p&gt;&#10;&#10;    &lt;figure&gt;&#10;        &lt;img src=&quot;&lt;?= $img ?&gt;&quot; alt=&quot;&lt;?= $alt ?&gt;&quot; title=&quot;&lt;?= $alt ?&gt;&quot;&gt;&#10;        &lt;figcaption&gt;&lt;?= $alt ?&gt;&lt;/figcaption&gt;&#10;    &lt;/figure&gt;&#10;&#10;    &lt;nav&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $prev ?&gt;&quot;&gt;&lt;button &lt;?= $disPrev ?&gt;&gt;Previous&lt;/button&gt;&lt;/a&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $next ?&gt;&quot;&gt;&lt;button &lt;?= $disNext ?&gt;&gt;Next&lt;/button&gt;&lt;/a&gt;&#10;        &lt;a href=&quot;/?id=&lt;?= $rand ?&gt;&quot;&gt;&lt;button&gt;Random&lt;/button&gt;&lt;/a&gt;&#10;&#10;        &lt;form class=&quot;inline&quot; method=&quot;get&quot; action=&quot;/&quot;&gt;&#10;            &lt;input type=&quot;number&quot; name=&quot;id&quot; min=&quot;1&quot; max=&quot;&lt;?= $latestNum ?&gt;&quot; placeholder=&quot;Go to #&quot;&gt;&#10;            &lt;button type=&quot;submit&quot;&gt;Go&lt;/button&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;a href=&quot;/&quot;&gt;&lt;button&gt;Today&lt;/button&gt;&lt;/a&gt;&#10;    &lt;/nav&gt;&#10;&lt;/div&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>